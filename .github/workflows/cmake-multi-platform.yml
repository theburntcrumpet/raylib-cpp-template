name: Build and Cross-Compile

on:
  release:
    types: [published]
  workflow_dispatch:

jobs:
  build-linux:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Install dependencies
      run: sudo apt-get update && sudo apt-get install -y g++ gcc xorg-dev

    - name: Build for Linux
      run: |
        mkdir -p build
        cd build
        cmake ..
        make

    - name: Publish Linux Build
      uses: actions/upload-artifact@v4
      with:
        name: linux-build
        path: build/game
        archive: zip

  cross-compile-windows:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y g++ gcc mingw-w64

    - name: Cross-compile for Windows
      run: |
        mkdir -p build
        cd build
        cmake -DCMAKE_TOOLCHAIN_FILE=../mingw-toolchain.cmake ..
        make

    - name: Publish Windows Build
      uses: actions/upload-artifact@v4
      with:
        name: windows-build
        path: build/game.exe
        archive: zip
